<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Repair Help - Transmission</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="https://i.pinimg.com/736x/c5/94/96/c5949627262b8098970838894f57c94e.jpg" onerror="this.href='https://placehold.co/32x32/1C4E80/FFFFFF?text=TR'">
    <style>
        /* General body styling for sticky footer */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Main content should grow to fill available space */
        .main-content {
            flex-grow: 1;
        }
        
        /* Background Video */
        #background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -10;
            opacity: 0.6;
        }

        /* Custom select arrow */
        .card select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%231C4E80%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right .7em top 50%;
            background-size: .65em auto;
            padding-right: 2.5em;
        }
        
        /* --- Improved Popup Styles --- */
        #solutionPopup {
            max-height: 85vh;
            overflow-y: auto;
        }

        .popup-active {
            display: flex !important;
            align-items: center;
            justify-content: center;
            opacity: 1 !important;
            transform: translate(-50%, -50%) scale(1) !important;
        }
        .popup-inactive {
            opacity: 0 !important;
            transform: translate(-50%, -50%) scale(0.95) !important;
            pointer-events: none;
        }

        .popup-step {
            margin-bottom: 1.5rem;
        }

        .popup-step p {
            margin-bottom: 0.75rem;
            text-align: left;
            color: #374151;
        }

        .popup-step img {
            max-width: 100%;
            height: auto;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Custom scrollbar for popup */
        #solutionPopup::-webkit-scrollbar {
            width: 8px;
        }
        #solutionPopup::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        #solutionPopup::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        #solutionPopup::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* --- Chatbot Styles (from engine.html) --- */
        .car-chatbot-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            transform: translateY(1000px); /* Start off-screen */
            transition: transform 0.3s ease-in-out;
            width: 90%;
            max-width: 450px;
            height: 85vh;
            max-height: 650px;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
            z-index: 1000;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            font-family: 'Poppins', sans-serif;
        }

        .car-chatbot-container.active {
            transform: translateY(0); /* Slide into view */
        }

        .car-chatbot-header {
            text-align: center;
            margin-bottom: 1.5rem;
            flex-shrink: 0;
        }
        .car-chatbot-header h1{
            color: #003865;
            font-size: 1.6rem;
            font-weight: 600;
        }
         .car-chatbot-header p{
            color: #4a5568;
            font-size: 0.95rem;
         }

        .car-chatbot-messages {
            margin-bottom: 1rem;
            flex-grow: 1;
            overflow-y: auto;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: #f7fafc;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .car-chatbot-message {
            display: flex;
        }
        .car-chatbot-message-content {
            padding: 0.75rem;
            border-radius: 1.3rem;
            max-width: 85%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .car-chatbot-message.user .car-chatbot-message-content {
            background-color: #e0f2fe;
            color: #003865;
            margin-left: auto;
        }
        .car-chatbot-message.bot .car-chatbot-message-content {
            background-color: #f0f4c3;
            color: #003865;
            margin-right: auto;
        }
        .car-chatbot-input-area {
            display: flex;
            flex-direction: column; /* To stack input and buttons */
            gap: 0.5rem;
            flex-shrink: 0;
        }
        .car-chatbot-input-area input {
            flex: 1;
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            outline: none;
            font-size: 1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .car-chatbot-input-area input:focus {
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.15);
        }

        .car-chatbot-input-area .button-group {
             display: flex;
             width: 100%;
             justify-content: space-between;
             gap: 0.5rem;
        }

        .car-chatbot-input-area button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            background-color: #4299e1;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex-grow: 1;
        }
        .car-chatbot-input-area button:hover {
            background-color: #3182ce;
        }

        .car-chatbot-input-area button:disabled{
            background-color: #a0aec0;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .car-chatbot-input-area .maintenance-tips-button {
            background-color: #9333ea; /* Purple from example */
        }
        .car-chatbot-input-area .maintenance-tips-button:hover {
             background-color: #7e22ce;
        }

        #car-chatbot-loading-indicator {
            display: none;
            margin: 1rem auto;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            border: 0.3rem solid rgba(66, 153, 225, 0.3);
            border-top: 0.3rem solid #4299e1;
            animation: spin 1s linear infinite;
             flex-shrink: 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .car-chatbot-suggestion-box {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #edf2f7;
            border: 1px solid #e2e8f0;
             flex-shrink: 0;
        }

        .car-chatbot-suggestion-box p {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4a5568;
            font-size: 0.95rem;
        }

        .car-chatbot-suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .car-chatbot-suggestion-list li {
            background-color: #f56565;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .car-chatbot-suggestion-list li:hover {
            background-color: #c53030;
        }
        .car-chatbot-icon{
            width: 1.2rem;
            height: 1.2rem;
        }

        #car-chatbot-toggle-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1001;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            background-color: #1C4E80;
            color: white;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease, transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        #car-chatbot-toggle-button:hover {
            background-color: #1a446e;
             transform: scale(1.05);
        }

        /* Responsive adjustments for chatbot */
        @media (max-width: 600px) {
            .car-chatbot-container {
                width: 95%;
                left: 2.5%;
                right: 2.5%;
                bottom: 10px;
                max-width: none;
                height: 80vh; /* Adjusted height for mobile */
            }
             #car-chatbot-toggle-button {
                left: 10px;
                bottom: 10px;
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
             }
             .car-chatbot-icon{
                width: 1rem;
                height: 1rem;
             }
             .car-chatbot-header h1 {
                font-size: 1.4rem;
             }
             .car-chatbot-message-content,
             .car-chatbot-input-area input,
             .car-chatbot-suggestion-box p,
             .car-chatbot-suggestion-list li {
                 font-size: 0.9rem;
             }
             .car-chatbot-input-area button {
                 padding: 0.6rem 1rem;
             }
        }
        /* End Chatbot Styles */

    </style>
</head>
<body class="text-gray-800">

    <video id="background-video" autoplay loop muted playsinline poster="https://placehold.co/1920x1080/333333/FFFFFF?text=Loading+Background...">
        <source src="https://videos.pexels.com/video-files/5514359/5514359-uhd_2560_1440_24fps.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Header (Navbar) - Changed to Dark Imperial Blue -->
    <header class="bg-[#1C4E80] text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold tracking-tight">Car Repair Assistance</h1>
        </div>
    </header>
    
    <!-- Main content area that will grow -->
    <div class="main-content">
        <main class="container mx-auto p-4 md:p-6">
            <div class="text-center mb-8 md:mb-12 bg-white bg-opacity-75 backdrop-blur-sm p-6 rounded-lg shadow-xl mt-4">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-[#1C4E80] mb-2">TRANSMISSION TROUBLES?</h1>
                <p class="text-gray-700 text-base sm:text-lg md:text-xl">You're in the right place! Find solutions to common transmission problems.</p>
            </div>

            <div class="mb-8 md:mb-12 max-w-2xl mx-auto bg-white bg-opacity-75 backdrop-blur-sm p-4 rounded-lg shadow-lg">
                <div class="flex flex-col sm:flex-row items-center gap-3">
                    <input type="text" id="searchInput" placeholder="Search problem (e.g., 'slipping', 'leak')" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent transition-shadow">
                    <button onclick="searchProblems()" class="w-full sm:w-auto bg-[#1C4E80] hover:bg-blue-800 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out transform hover:scale-105">
                        Search
                    </button>
                </div>
            </div>

            <div id="cardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Cards remain the same -->
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">1. Fluid Leak</h3>
                        <p class="text-gray-600 mb-4 text-sm">Red/brown fluid puddles under car.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="A">Damaged Seals</option>
                        <option value="B">Loose Connections</option>
                        <option value="C">Corrosion</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">2. Slipping</h3>
                        <p class="text-gray-600 mb-4 text-sm">Engine revs, car doesn't accelerate.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="D">Worn Clutches</option>
                        <option value="E">Faulty Solenoids</option>
                        <option value="F">Low Fluid Levels (Slipping)</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">3. Delayed Engagement</h3>
                        <p class="text-gray-600 mb-4 text-sm">Pause when shifting to D or R.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="G">Low Fluid Pressure</option>
                        <option value="H">Dirty Transmission Filter</option>
                        <option value="I">Faulty TCM</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">4. Harsh Shifting</h3>
                        <p class="text-gray-600 mb-4 text-sm">Jerking/clunking during shifts.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="J">Worn Transmission Bands</option>
                        <option value="K">Improper Fluid Type</option>
                        <option value="L">Dirty Transmission Components</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">5. Overheating</h3>
                        <p class="text-gray-600 mb-4 text-sm">Burning smell or warning light.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="M">Low Fluid Levels (Overheating)</option>
                        <option value="N">Blocked Cooling Lines</option>
                        <option value="O">Faulty Cooling Fan</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">6. Unusual Noises</h3>
                        <p class="text-gray-600 mb-4 text-sm">Whining, buzzing, clunking.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="P">Worn Bearings</option>
                        <option value="Q">Loose Components</option>
                        <option value="R">Lack of Lubrication</option>
                    </select>
                </div>
                 <div id="noResultsMessage" class="hidden col-span-1 sm:col-span-2 lg:col-span-3 text-center py-10 bg-white bg-opacity-75 backdrop-blur-sm rounded-lg shadow-lg">
                    <img src="https://placehold.co/100x100/E0E0E0/757575?text=:(" alt="No results" class="mx-auto mb-4 rounded-lg" onerror="this.src='https://placehold.co/100x100/E0E0E0/757575?text=Error'; this.alt='Error loading image'">
                    <p class="text-xl text-gray-600">No matching problems found. Try a different search term or ask our AI assistant!</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-[#1C4E80] text-gray-300 py-8 md:py-10 z-40 mt-auto">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <h3 class="text-base lg:text-lg font-semibold text-white mb-3">About Us</h3>
                    <p class="text-xs lg:text-sm">Committed to helping you solve car problems efficiently.</p>
                </div>
                <div>
                    <h3 class="text-base lg:text-lg font-semibold text-white mb-3">Quick Help</h3>
                    <p class="text-xs lg:text-sm">Browse FAQs or use our AI assistant for instant support.</p>
                    <button onclick="window.open('https://query-fire-base-v1.vercel.app/', '_blank')" class="mt-2 text-xs lg:text-sm text-blue-300 hover:text-blue-200 transition-colors">Advanced Query (External)</button>
                </div>
                <div>
                    <h3 class="text-base lg:text-lg font-semibold text-white mb-3">Contact</h3>
                    <p class="text-xs lg:text-sm">Email: support@carrepairhelp.com</p>
                    <p class="text-xs lg:text-sm">Phone: +123 456 7890</p>
                </div>
            </div>
            <div class="mt-6 md:mt-8 border-t border-blue-700 pt-5 md:pt-6 text-center text-xs lg:text-sm">
                <p>&copy; <span id="currentYear"></span> Car Repair Assistance. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-[100] hidden" onclick="closeAllPopups()"></div>

    <!-- Redesigned Solution Popup -->
    <div id="solutionPopup" class="fixed top-1/2 left-1/2 w-11/12 max-w-2xl p-5 sm:p-6 rounded-xl shadow-2xl z-[101] bg-white transition-all duration-300 ease-out popup-inactive">
        <div class="flex justify-between items-center mb-4 pb-4 border-b">
            <div>
                <h2 id="popupTitle" class="text-xl md:text-2xl font-bold text-[#1C4E80]">Solution Details</h2>
                <p id="popupDescription" class="text-sm text-gray-500 mt-1"></p>
            </div>
            <button onclick="closeSolutionPopup()" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
        </div>
        <div id="popupContentContainer" class="space-y-4">
            <!-- JS will populate this with steps -->
        </div>
        <button onclick="closeSolutionPopup()" class="mt-6 w-full bg-[#1C4E80] hover:bg-blue-800 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out">
            Close
        </button>
    </div>

    <!-- Help Button -->
    <button onclick="openHelpPopup()" title="Get Help" class="fixed bottom-24 right-5 md:right-8 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-xl transition-all duration-150 ease-in-out transform hover:scale-110 z-50 flex items-center justify-center w-14 h-14">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
        </svg>
    </button>
    
    <!-- Help Popup -->
    <div id="helpPopup" class="fixed top-1/2 left-1/2 w-11/12 max-w-md p-5 sm:p-6 rounded-xl shadow-2xl z-[101] bg-white transition-all duration-300 ease-out popup-inactive">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg sm:text-xl font-semibold text-blue-700">Need More Help?</h2>
            <button onclick="closeHelpPopup()" class="text-gray-500 hover:text-gray-800 text-2xl sm:text-3xl">&times;</button>
        </div>
        <p class="text-gray-700 mb-2 text-sm sm:text-base">Contact our support team for additional assistance or use our AI Chatbot.</p>
        <p class="text-gray-700 text-sm sm:text-base"><span class="font-medium">Email:</span> support@carrepairhelp.com</p>
        <p class="text-gray-700 mb-4 text-sm sm:text-base"><span class="font-medium">Phone:</span> +123 456 7890</p>
        <button onclick="closeHelpPopup()" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out">
            Got it!
        </button>
    </div>

    <!-- Chatbot Toggle Button -->
    <button id="car-chatbot-toggle-button">
        <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/message-circle.svg" alt="Chatbot" class="car-chatbot-icon">
        Chatbot
    </button>

    <!-- Chatbot Window -->
    <div class="car-chatbot-container" id="car-chatbot-container">
        <header class="car-chatbot-header">
            <h1>CarChatBot</h1>
            <p>Your Virtual Car Assistant</p>
        </header>
        <div class="car-chatbot-messages" id="car-chatbot-messages"></div>
        <div class="car-chatbot-input-area">
            <input type="text" id="car-chatbot-user-input" placeholder="Ask about a car problem...">
            <div class="button-group">
                <button id="car-chatbot-send-button" disabled>
                    <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/send.svg" alt="Send" class="car-chatbot-icon">
                    Send
                </button>
                <button id="car-chatbot-generate-tips-button" class="maintenance-tips-button">
                    âœ¨ Get Maintenance Tips
                </button>
            </div>
        </div>
        <div id="car-chatbot-loading-indicator"></div>
        <div class="car-chatbot-suggestion-box" id="car-chatbot-suggestion-box">
            <p>Common transmission problems:</p>
            <ul class="car-chatbot-suggestion-list" id="car-chatbot-suggestion-list"></ul>
        </div>
    </div>

<script>
    // --- NEW Step-by-Step Solution Data ---
    const solutions = {
        'A': {
            title: "Fixing Leaks from Damaged Seals",
            description: "Worn-out or damaged seals are a common cause of transmission fluid leaks.",
            steps: [
                { text: "<b>Step 1: Inspect Seals.</b> First, locate the transmission seals at the axles and driveshaft. Clean the area and look closely for any signs of cracking, hardening, or fluid seepage.", image: "https://placehold.co/600x400/AEC6CF/000000?text=1.+Inspect+Seals" },
                { text: "<b>Step 2: Replacement is Key.</b> Damaged seals cannot be repaired; they must be replaced. This is often a job for a professional as it may require specialized tools to remove the old seal and press in a new one without damage.", image: "https://placehold.co/600x400/CDB8DF/000000?text=2.+Replace+Damaged+Seal" }
            ]
        },
        'B': {
            title: "Fixing Leaks from Loose Connections",
            description: "Sometimes a leak is simply due to a loose pan, bolt, or cooler line.",
            steps: [
                { text: "<b>Step 1: Check Transmission Pan.</b> Inspect the bolts on the transmission fluid pan. Use a torque wrench to tighten them to the manufacturer's specified setting. Do not overtighten.", image: "https://placehold.co/600x400/ADD8E6/000000?text=1.+Check+Pan+Bolts" },
                { text: "<b>Step 2: Inspect Cooler Lines.</b> Check the connections where the transmission cooler lines meet the radiator and the transmission. Carefully tighten any fittings that are loose.", image: "https://placehold.co/600x400/BAF0BA/000000?text=2.+Tighten+Cooler+Lines" }
            ]
        },
        'C': {
            title: "Fixing Leaks from Corrosion",
            description: "Corrosion on the transmission pan or cooling lines can cause small holes and leaks.",
            steps: [
                { text: "<b>Step 1: Identify Corrosion.</b> Look for bubbling paint, rust, or white, chalky residue on metal parts. The transmission pan is a common place for rust to form.", image: "https://placehold.co/600x400/FFDDC1/000000?text=1.+Identify+Corrosion" },
                { text: "<b>Step 2: Replace Corroded Parts.</b> If corrosion has created a hole, the part (like the pan or a cooler line) must be replaced. Sanding and patching is not a reliable long-term solution for pressurized systems.", image: "https://placehold.co/600x400/AEC6CF/000000?text=2.+Replace+Corroded+Pan" }
            ]
        },
        'D': {
            title: "Troubleshooting Worn Clutches",
            description: "Worn clutches inside the transmission can't grip properly, causing slipping.",
            steps: [
                { text: "<b>Step 1: Confirm Symptoms.</b> Besides slipping, you might notice delayed or harsh shifting and dirty, burnt-smelling fluid. This is a strong indicator of internal wear.", image: "https://placehold.co/600x400/CDB8DF/000000?text=1.+Burnt+Fluid+Smell" },
                { text: "<b>Step 2: Professional Repair Needed.</b> Replacing clutches is a major repair that requires completely disassembling the transmission. This job should be left to a professional transmission shop.", image: "https://placehold.co/600x400/ADD8E6/000000?text=2.+Professional+Repair" }
            ]
        },
        'E': {
            title: "Diagnosing Faulty Solenoids",
            description: "Solenoids are electronic valves that control fluid flow. If one fails, it can cause various shifting problems.",
            steps: [
                { text: "<b>Step 1: Scan for Codes.</b> A faulty solenoid will usually trigger the Check Engine light and store a diagnostic trouble code (DTC). Use an OBD-II scanner to read the codes.", image: "https://placehold.co/600x400/BAF0BA/000000?text=1.+OBD-II+Scan" },
                { text: "<b>Step 2: Locate and Replace.</b> Based on the code, a specific solenoid can be identified. They are often accessible by removing the transmission pan. Replace the faulty solenoid with a new one.", image: "https://placehold.co/600x400/FFDDC1/000000?text=2.+Replace+Solenoid" }
            ]
        },
        'F': {
            title: "Fixing Slipping from Low Fluid",
            description: "The most common cause of slipping is low transmission fluid.",
            steps: [
                { text: "<b>Step 1: Check Fluid Level.</b> With the engine warm and running, and the car in Park or Neutral (check manual), pull the transmission dipstick. Wipe it, re-insert it fully, then pull it out again to check the level.", image: "https://placehold.co/600x400/AEC6CF/000000?text=1.+Check+Dipstick" },
                { text: "<b>Step 2: Add Correct Fluid.</b> If low, add the specific type of transmission fluid recommended in your owner's manual. Add a little at a time, re-checking the level until it's full. Do not overfill. Also, find and fix the cause of the fluid loss.", image: "https://placehold.co/600x400/CDB8DF/000000?text=2.+Add+Correct+Fluid" }
            ]
        },
        // Continue this detailed step-by-step pattern for G through R...
        'G':{title:"Fixing Low Fluid Pressure",description:"Low pressure causes delays in gear engagement.",steps:[{text:"<b>Step 1: Check Fluid Level First.</b> Low fluid is the primary cause of low pressure. Ensure it's at the correct level before proceeding.",image:"https://placehold.co/600x400/ADD8E6/000000?text=1.+Check+Fluid+Again"},{text:"<b>Step 2: Check for Clogs.</b> A clogged transmission filter can also cause low pressure. If the fluid is old or dirty, replacing the filter is a good next step.",image:"https://placehold.co/600x400/BAF0BA/000000?text=2.+Inspect+Filter"}]},
        'H':{title:"Replacing a Dirty Transmission Filter",description:"A clogged filter restricts fluid flow, causing shifting issues.",steps:[{text:"<b>Step 1: Drain Fluid and Remove Pan.</b> You'll need to drain the transmission fluid and remove the pan to access the filter.",image:"https://placehold.co/600x400/FFDDC1/000000?text=1.+Remove+Pan"},{text:"<b>Step 2: Replace Filter and Gasket.</b> Remove the old filter (it may be held by bolts or just a seal), install the new one, and replace the pan gasket before reinstalling the pan and refilling with fluid.",image:"https://placehold.co/600x400/AEC6CF/000000?text=2.+Install+New+Filter"}]},
        'I':{title:"Diagnosing a Faulty TCM",description:"The Transmission Control Module (TCM) is the transmission's brain.",steps:[{text:"<b>Step 1: Check for Trouble Codes.</b> A faulty TCM will almost always generate error codes. An OBD-II scan is the first step.",image:"https://placehold.co/600x400/CDB8DF/000000?text=1.+Scan+for+TCM+Codes"},{text:"<b>Step 2: Professional Diagnosis.</b> TCM issues can be complex, involving software or internal hardware failure. This typically requires diagnosis and repair by a professional.",image:"https://placehold.co/600x400/ADD8E6/000000?text=2.+Professional+Help"}]},
        'J':{title:"Addressing Worn Transmission Bands",description:"Bands help stop gears during shifts. Worn bands cause harshness.",steps:[{text:"<b>Step 1: Band Adjustment.</b> Some older transmissions have adjustable bands. This can be a temporary fix but is less common on modern cars.",image:"https://placehold.co/600x400/BAF0BA/000000?text=1.+Band+Adjustment+Screw"},{text:"<b>Step 2: Internal Repair Required.</b> Like clutches, replacing worn bands requires a full transmission teardown and should be done by a specialist.",image:"https://placehold.co/600x400/FFDDC1/000000?text=2.+Transmission+Teardown"}]},
        'K':{title:"Using the Proper Fluid Type",description:"Using the wrong fluid can cause damage and harsh shifts.",steps:[{text:"<b>Step 1: Check Your Owner's Manual.</b> The manual specifies the exact type of fluid your transmission needs (e.g., ATF+4, Mercon V, Dexron VI).",image:"https://placehold.co/600x400/AEC6CF/000000?text=1.+Read+Owner%27s+Manual"},{text:"<b>Step 2: Drain and Refill.</b> If the wrong fluid is in the transmission, it should be completely drained (or flushed by a professional) and refilled with the correct type.",image:"https://placehold.co/600x400/CDB8DF/000000?text=2.+Fluid+Flush"}]},
        'L':{title:"Cleaning Dirty Components",description:"Dirty fluid can cause valves and solenoids to stick.",steps:[{text:"<b>Step 1: Assess Fluid Condition.</b> Dark, dirty, or burnt-smelling fluid indicates a problem. It should be red or pink and mostly clear.",image:"https://placehold.co/600x400/ADD8E6/000000?text=1.+Assess+Fluid+Color"},{text:"<b>Step 2: Fluid and Filter Change.</b> The best way to clean internal components is to change the transmission fluid and filter. This removes contaminants and restores proper function.",image:"https://placehold.co/600x400/BAF0BA/000000?text=2.+Fluid+and+Filter+Change"}]},
        'M':{title:"Fixing Overheating from Low Fluid",description:"Fluid both lubricates and cools the transmission.",steps:[{text:"<b>Step 1: Check Fluid When Hot.</b> An overheating warning is a sign to check fluid levels immediately (but safely). Low fluid is a likely culprit.",image:"https://placehold.co/600x400/FFDDC1/000000?text=1.+Check+Level+When+Hot"},{text:"<b>Step 2: Find and Fix the Leak.</b> Topping off the fluid is a temporary fix. You must find and repair the source of the leak to prevent recurrence.",image:"https://placehold.co/600x400/AEC6CF/000000?text=2.+Find+the+Leak"}]},
        'N':{title:"Clearing Blocked Cooling Lines",description:"Blockages prevent fluid from reaching the cooler.",steps:[{text:"<b>Step 1: Locate Lines.</b> Find the two lines running from the transmission to the radiator. Check for any kinks or physical damage.",image:"https://placehold.co/600x400/CDB8DF/000000?text=1.+Locate+Cooling+Lines"},{text:"<b>Step 2: Professional Flush.</b> A professional power flush is the most effective way to clear internal blockages from the lines and the cooler itself.",image:"https://placehold.co/600x400/ADD8E6/000000?text=2.+Professional+Flush"}]},
        'O':{title:"Diagnosing a Faulty Cooling Fan",description:"The fan cools the radiator, which also cools the transmission fluid.",steps:[{text:"<b>Step 1: Check Fan Operation.</b> Let the car idle until it reaches operating temperature. The cooling fan(s) should turn on. If not, there's a problem.",image:"https://placehold.co/600x400/BAF0BA/000000?text=1.+Watch+Fan+Operation"},{text:"<b>Step 2: Check Fuses and Relays.</b> Before replacing the fan motor, check the vehicle's fuse box for a blown fan fuse or a bad relay. These are common and inexpensive fixes.",image:"https://placehold.co/600x400/FFDDC1/000000?text=2.+Check+Fuse+Box"}]},
        'P':{title:"Diagnosing Worn Bearings",description:"Worn bearings produce a whining or grinding noise that changes with engine speed.",steps:[{text:"<b>Step 1: Listen Carefully.</b> Try to determine if the noise is present in all gears or only specific ones. This can help a mechanic pinpoint the location.",image:"https://placehold.co/600x400/AEC6CF/000000?text=1.+Listen+for+Noise"},{text:"<b>Step 2: Seek Professional Help.</b> Bearing replacement requires a complete transmission rebuild and is not a DIY job.",image:"https://placehold.co/600x400/CDB8DF/000000?text=2.+Visit+Mechanic"}]},
        'Q':{title:"Fixing Noises from Loose Components",description:"Clunking can be caused by loose mounts or other components.",steps:[{text:"<b>Step 1: Check Transmission Mounts.</b> Visually inspect the mounts that hold the transmission to the car's frame. Look for cracked rubber or excessive movement.",image:"https://placehold.co/600x400/ADD8E6/000000?text=1.+Inspect+Mounts"},{text:"<b>Step 2: Check Driveshaft/Axles.</b> Check for excessive play in the driveshaft U-joints or CV axles. A clunk when shifting into gear can be a sign of a bad U-joint.",image:"https://placehold.co/600x400/BAF0BA/000000?text=2.+Check+Driveshaft"}]},
        'R':{title:"Fixing Noises from Lack of Lubrication",description:"A whining noise that gets louder as the car accelerates is a classic sign of low fluid.",steps:[{text:"<b>Step 1: Check Fluid Level Immediately.</b> This is the most critical first step. Stop driving if possible and check the fluid level.",image:"https://placehold.co/600x400/FFDDC1/000000?text=1.+Check+Fluid+Now"},{text:"<b>Step 2: Top Up and Inspect for Leaks.</b> Add the correct fluid type to bring it to the proper level. Then, thoroughly inspect the vehicle for the source of the leak.",image:"https://placehold.co/600x400/AEC6CF/000000?text=2.+Top+Up+and+Inspect"}]}
    };


    // --- Page interaction script ---
    const overlay = document.getElementById('overlay');
    const solutionPopup = document.getElementById('solutionPopup');
    const helpPopup = document.getElementById('helpPopup');

    function openSolutionPopup(optionValue) {
        const data = solutions[optionValue];
        if (data) {
            document.getElementById('popupTitle').textContent = data.title;
            document.getElementById('popupDescription').textContent = data.description;
            
            const contentContainer = document.getElementById('popupContentContainer');
            contentContainer.innerHTML = ''; // Clear previous steps
            
            if (data.steps && data.steps.length > 0) {
                data.steps.forEach(step => {
                    const stepDiv = document.createElement('div');
                    stepDiv.className = 'popup-step bg-gray-50 p-4 rounded-lg';

                    const stepText = document.createElement('p');
                    stepText.innerHTML = step.text; // Use innerHTML to render bold tags

                    const stepImg = document.createElement('img');
                    stepImg.src = step.image;
                    stepImg.alt = step.text;

                    stepDiv.appendChild(stepText);
                    stepDiv.appendChild(stepImg);
                    contentContainer.appendChild(stepDiv);
                });
            }

            overlay.classList.remove('hidden');
            solutionPopup.classList.remove('popup-inactive');
            solutionPopup.classList.add('popup-active');
        }
    }

    function closeSolutionPopup() {
        overlay.classList.add('hidden');
        solutionPopup.classList.add('popup-inactive');
        solutionPopup.classList.remove('popup-active');
    }

    function openHelpPopup() {
        overlay.classList.remove('hidden');
        helpPopup.classList.remove('popup-inactive');
        helpPopup.classList.add('popup-active');
    }

    function closeHelpPopup() {
        overlay.classList.add('hidden');
        helpPopup.classList.add('popup-inactive');
        helpPopup.classList.remove('popup-active');
    }

    function closeAllPopups() {
        closeSolutionPopup();
        closeHelpPopup();
        if (chatbotContainer.classList.contains('active')) {
             toggleChatbot(false);
        }
    }

    function optionClicked(value, selectElement) {
        openSolutionPopup(value);
        if(selectElement) {
            selectElement.selectedIndex = 0;
        }
    }

    function searchProblems() {
        const input = document.getElementById('searchInput').value.toLowerCase().trim();
        const cards = document.querySelectorAll('#cardsContainer .card');
        const noResultsMessage = document.getElementById('noResultsMessage');
        let resultsFound = false;

        cards.forEach(card => {
            const cardTexts = (card.textContent || card.innerText).toLowerCase();
            if (cardTexts.includes(input)) {
                card.style.display = 'flex';
                resultsFound = true;
            } else {
                card.style.display = 'none';
            }
        });

        noResultsMessage.classList.toggle('hidden', resultsFound);
    }
    
    document.getElementById('searchInput').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            searchProblems();
        }
    });

    document.getElementById('currentYear').textContent = new Date().getFullYear();

    // --- New Chatbot Script (from engine.html) ---
    const chatMessages = document.getElementById('car-chatbot-messages');
    const userInput = document.getElementById('car-chatbot-user-input');
    const sendButton = document.getElementById('car-chatbot-send-button');
    const loadingIndicator = document.getElementById('car-chatbot-loading-indicator');
    const suggestionList = document.getElementById('car-chatbot-suggestion-list');
    const suggestionBox = document.getElementById('car-chatbot-suggestion-box');
    const chatbotContainer = document.getElementById('car-chatbot-container');
    const chatbotToggleButton = document.getElementById('car-chatbot-toggle-button');
    const generateTipsButton = document.getElementById('car-chatbot-generate-tips-button');

    const commonProblems = [
        "transmission fluid leak", "gear slipping", "delayed engagement",
        "harsh shifting", "transmission overheating", "whining noise",
    ];

    function populateSuggestions() {
        suggestionList.innerHTML = '';
        commonProblems.forEach(problem => {
            const listItem = document.createElement('li');
            listItem.textContent = problem;
            listItem.addEventListener('click', () => {
                userInput.value = problem;
                handleInputChange();
                sendMessage();
            });
            suggestionList.appendChild(listItem);
        });
    }

    async function getGeminiResponse(prompt) {
        loadingIndicator.style.display = 'block';
        sendButton.disabled = true;
        userInput.disabled = true;
        generateTipsButton.disabled = true;
        suggestionBox.style.display = 'none';

        try {
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            if (result.candidates?.[0]?.content?.parts?.[0]) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                return "Sorry, I received an unusual response from the AI. Please try again.";
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return "An error occurred while connecting to the AI. Please check the console for details.";
        } finally {
            loadingIndicator.style.display = 'none';
            userInput.disabled = false;
            generateTipsButton.disabled = false;
            suggestionBox.style.display = 'block';
            handleInputChange();
        }
    }

    async function sendMessage() {
        const userText = userInput.value.trim();
        if (!userText) return;

        addMessage('user', userText);
        userInput.value = '';
        handleInputChange();

        const botResponse = await getGeminiResponse(`Provide detailed car repair advice for the following transmission problem: ${userText}`);
        addMessage('bot', botResponse);
    }

    async function generateMaintenanceTips() {
        addMessage('user', "Generate some car maintenance tips.");
        const prompt = "Generate 5 practical and concise maintenance tips for a car's transmission system. Include advice on fluid, driving habits, and regular checks.";
        const botResponse = await getGeminiResponse(prompt);
        addMessage('bot', botResponse);
    }

    function addMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('car-chatbot-message', sender);
        const messageContentDiv = document.createElement('div');
        messageContentDiv.classList.add('car-chatbot-message-content');
        messageContentDiv.innerHTML = text.replace(/\n/g, '<br>');
        messageDiv.appendChild(messageContentDiv);
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function handleInputChange() {
        sendButton.disabled = !userInput.value.trim();
    }
    
    function toggleChatbot(forceClose = null) {
        const isActive = chatbotContainer.classList.contains('active');
        const shouldBeActive = forceClose === null ? !isActive : !forceClose;

        chatbotContainer.classList.toggle('active', shouldBeActive);
        if (shouldBeActive) {
            chatbotToggleButton.innerHTML = `<img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/x-circle.svg" alt="Close" class="car-chatbot-icon"> Close`;
        } else {
            chatbotToggleButton.innerHTML = `<img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/message-circle.svg" alt="Chatbot" class="car-chatbot-icon"> Chatbot`;
        }
    }


    // --- Event Listeners ---
    userInput.addEventListener('input', handleInputChange);
    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !sendButton.disabled) {
            sendMessage();
        }
    });
    generateTipsButton.addEventListener('click', generateMaintenanceTips);
    chatbotToggleButton.addEventListener('click', () => toggleChatbot());

    // Initialize chatbot on load
    addMessage('bot', "Hello! I'm your virtual car assistant. What transmission problem are you experiencing?");
    populateSuggestions();
</script>
</body>
</html>
