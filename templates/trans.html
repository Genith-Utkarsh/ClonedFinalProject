<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Car Repair Help - Transmission</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="https://i.pinimg.com/736x/c5/94/96/c5949627262b8098970838894f57c94e.jpg" onerror="this.href='https://placehold.co/32x32/1C4E80/FFFFFF?text=TR'">
    <style>
        /* General body styling for sticky footer */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        /* Main content should grow to fill available space */
        .main-content {
            flex-grow: 1;
        }
        
        /* Background Video */
        #background-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -10;
            opacity: 0.6;
        }

        /* Custom select arrow */
        .card select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%231C4E80%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right .7em top 50%;
            background-size: .65em auto;
            padding-right: 2.5em;
        }
        
        /* Popup visibility and centering */
        .popup-active {
            display: flex !important;
            align-items: center;
            justify-content: center;
            opacity: 1 !important;
            transform: translate(-50%, -50%) scale(1) !important;
        }
        .popup-inactive {
            opacity: 0 !important;
            transform: translate(-50%, -50%) scale(0.95) !important;
            pointer-events: none;
        }

        /* --- Chatbot Styles (from engine.html) --- */
        .car-chatbot-container {
            position: fixed;
            bottom: 20px;
            left: 20px;
            transform: translateY(1000px); /* Start off-screen */
            transition: transform 0.3s ease-in-out;
            width: 90%;
            max-width: 450px;
            height: 85vh;
            max-height: 650px;
            padding: 1rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
            z-index: 1000;
            overflow: hidden;
            border: 1px solid #e2e8f0;
            display: flex;
            flex-direction: column;
            font-family: 'Poppins', sans-serif;
        }

        .car-chatbot-container.active {
            transform: translateY(0); /* Slide into view */
        }

        .car-chatbot-header {
            text-align: center;
            margin-bottom: 1.5rem;
            flex-shrink: 0;
        }
        .car-chatbot-header h1{
            color: #003865;
            font-size: 1.6rem;
            font-weight: 600;
        }
         .car-chatbot-header p{
            color: #4a5568;
            font-size: 0.95rem;
         }

        .car-chatbot-messages {
            margin-bottom: 1rem;
            flex-grow: 1;
            overflow-y: auto;
            padding: 0.5rem;
            border-radius: 0.5rem;
            background-color: #f7fafc;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        .car-chatbot-message {
            display: flex;
        }
        .car-chatbot-message-content {
            padding: 0.75rem;
            border-radius: 1.3rem;
            max-width: 85%;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            font-size: 0.95rem;
            line-height: 1.4;
        }
        .car-chatbot-message.user .car-chatbot-message-content {
            background-color: #e0f2fe;
            color: #003865;
            margin-left: auto;
        }
        .car-chatbot-message.bot .car-chatbot-message-content {
            background-color: #f0f4c3;
            color: #003865;
            margin-right: auto;
        }
        .car-chatbot-input-area {
            display: flex;
            flex-direction: column; /* To stack input and buttons */
            gap: 0.5rem;
            flex-shrink: 0;
        }
        .car-chatbot-input-area input {
            flex: 1;
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 1px solid #e2e8f0;
            outline: none;
            font-size: 1rem;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .car-chatbot-input-area input:focus {
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.15);
        }

        .car-chatbot-input-area .button-group {
             display: flex;
             width: 100%;
             justify-content: space-between;
             gap: 0.5rem;
        }

        .car-chatbot-input-area button {
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            background-color: #4299e1;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.3s ease;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            flex-grow: 1;
        }
        .car-chatbot-input-area button:hover {
            background-color: #3182ce;
        }

        .car-chatbot-input-area button:disabled{
            background-color: #a0aec0;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .car-chatbot-input-area .maintenance-tips-button {
            background-color: #9333ea; /* Purple from example */
        }
        .car-chatbot-input-area .maintenance-tips-button:hover {
             background-color: #7e22ce;
        }

        #car-chatbot-loading-indicator {
            display: none;
            margin: 1rem auto;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            border: 0.3rem solid rgba(66, 153, 225, 0.3);
            border-top: 0.3rem solid #4299e1;
            animation: spin 1s linear infinite;
             flex-shrink: 0;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .car-chatbot-suggestion-box {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #edf2f7;
            border: 1px solid #e2e8f0;
             flex-shrink: 0;
        }

        .car-chatbot-suggestion-box p {
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #4a5568;
            font-size: 0.95rem;
        }

        .car-chatbot-suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .car-chatbot-suggestion-list li {
            background-color: #f56565;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 1rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .car-chatbot-suggestion-list li:hover {
            background-color: #c53030;
        }
        .car-chatbot-icon{
            width: 1.2rem;
            height: 1.2rem;
        }

        #car-chatbot-toggle-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            z-index: 1001;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            background-color: #1C4E80;
            color: white;
            font-weight: 500;
            cursor: pointer;
            border: none;
            transition: background-color 0.3s ease, transform 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        #car-chatbot-toggle-button:hover {
            background-color: #1a446e;
             transform: scale(1.05);
        }

        /* Responsive adjustments for chatbot */
        @media (max-width: 600px) {
            .car-chatbot-container {
                width: 95%;
                left: 2.5%;
                right: 2.5%;
                bottom: 10px;
                max-width: none;
                height: 80vh; /* Adjusted height for mobile */
            }
             #car-chatbot-toggle-button {
                left: 10px;
                bottom: 10px;
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
             }
             .car-chatbot-icon{
                width: 1rem;
                height: 1rem;
             }
             .car-chatbot-header h1 {
                font-size: 1.4rem;
             }
             .car-chatbot-message-content,
             .car-chatbot-input-area input,
             .car-chatbot-suggestion-box p,
             .car-chatbot-suggestion-list li {
                 font-size: 0.9rem;
             }
             .car-chatbot-input-area button {
                 padding: 0.6rem 1rem;
             }
        }
        /* End Chatbot Styles */

    </style>
</head>
<body class="text-gray-800">

    <video id="background-video" autoplay loop muted playsinline poster="https://placehold.co/1920x1080/333333/FFFFFF?text=Loading+Background...">
        <source src="https://videos.pexels.com/video-files/5514359/5514359-uhd_2560_1440_24fps.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>

    <!-- Header (Navbar) - Changed to Dark Imperial Blue -->
    <header class="bg-[#1C4E80] text-white p-4 shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-xl sm:text-2xl md:text-3xl font-bold tracking-tight">Car Repair Assistance</h1>
        </div>
    </header>
    
    <!-- Main content area that will grow -->
    <div class="main-content">
        <main class="container mx-auto p-4 md:p-6">
            <div class="text-center mb-8 md:mb-12 bg-white bg-opacity-75 backdrop-blur-sm p-6 rounded-lg shadow-xl mt-4">
                <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-[#1C4E80] mb-2">TRANSMISSION TROUBLES?</h1>
                <p class="text-gray-700 text-base sm:text-lg md:text-xl">You're in the right place! Find solutions to common transmission problems.</p>
            </div>

            <div class="mb-8 md:mb-12 max-w-2xl mx-auto bg-white bg-opacity-75 backdrop-blur-sm p-4 rounded-lg shadow-lg">
                <div class="flex flex-col sm:flex-row items-center gap-3">
                    <input type="text" id="searchInput" placeholder="Search problem (e.g., 'slipping', 'leak')" class="w-full px-4 py-3 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent transition-shadow">
                    <button onclick="searchProblems()" class="w-full sm:w-auto bg-[#1C4E80] hover:bg-blue-800 text-white font-semibold px-6 py-3 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out transform hover:scale-105">
                        Search
                    </button>
                </div>
            </div>

            <div id="cardsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                <!-- Cards remain the same as in the original trans.html -->
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">1. Fluid Leak</h3>
                        <p class="text-gray-600 mb-4 text-sm">Red/brown fluid puddles under car.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="A">Damaged Seals</option>
                        <option value="B">Loose Connections</option>
                        <option value="C">Corrosion</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">2. Slipping</h3>
                        <p class="text-gray-600 mb-4 text-sm">Engine revs, car doesn't accelerate.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="D">Worn Clutches</option>
                        <option value="E">Faulty Solenoids</option>
                        <option value="F">Low Fluid Levels (Slipping)</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">3. Delayed Engagement</h3>
                        <p class="text-gray-600 mb-4 text-sm">Pause when shifting to D or R.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="G">Low Fluid Pressure</option>
                        <option value="H">Dirty Transmission Filter</option>
                        <option value="I">Faulty TCM</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">4. Harsh Shifting</h3>
                        <p class="text-gray-600 mb-4 text-sm">Jerking/clunking during shifts.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="J">Worn Transmission Bands</option>
                        <option value="K">Improper Fluid Type</option>
                        <option value="L">Dirty Transmission Components</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">5. Overheating</h3>
                        <p class="text-gray-600 mb-4 text-sm">Burning smell or warning light.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="M">Low Fluid Levels (Overheating)</option>
                        <option value="N">Blocked Cooling Lines</option>
                        <option value="O">Faulty Cooling Fan</option>
                    </select>
                </div>
                <div class="card bg-white bg-opacity-80 backdrop-blur-sm rounded-xl shadow-lg hover:shadow-2xl transition-shadow duration-300 p-6 flex flex-col justify-between">
                    <div>
                        <h3 class="text-xl sm:text-2xl font-semibold text-[#1C4E80] mb-1">6. Unusual Noises</h3>
                        <p class="text-gray-600 mb-4 text-sm">Whining, buzzing, clunking.</p>
                    </div>
                    <select onchange="optionClicked(this.value, this)" class="w-full p-3 border border-gray-300 rounded-lg bg-white focus:ring-2 focus:ring-[#1C4E80] focus:border-transparent text-sm">
                        <option value="" selected disabled>Select Potential Cause</option>
                        <option value="P">Worn Bearings</option>
                        <option value="Q">Loose Components</option>
                        <option value="R">Lack of Lubrication</option>
                    </select>
                </div>
                 <div id="noResultsMessage" class="hidden col-span-1 sm:col-span-2 lg:col-span-3 text-center py-10 bg-white bg-opacity-75 backdrop-blur-sm rounded-lg shadow-lg">
                    <img src="https://placehold.co/100x100/E0E0E0/757575?text=:(" alt="No results" class="mx-auto mb-4 rounded-lg" onerror="this.src='https://placehold.co/100x100/E0E0E0/757575?text=Error'; this.alt='Error loading image'">
                    <p class="text-xl text-gray-600">No matching problems found. Try a different search term or ask our AI assistant!</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer - No longer fixed -->
    <footer class="bg-[#1C4E80] text-gray-300 py-8 md:py-10 z-40 mt-auto">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center md:text-left">
                <div>
                    <h3 class="text-base lg:text-lg font-semibold text-white mb-3">About Us</h3>
                    <p class="text-xs lg:text-sm">Committed to helping you solve car problems efficiently.</p>
                </div>
                <div>
                    <h3 class="text-base lg:text-lg font-semibold text-white mb-3">Quick Help</h3>
                    <p class="text-xs lg:text-sm">Browse FAQs or use our AI assistant for instant support.</p>
                    <button onclick="window.open('https://query-fire-base-v1.vercel.app/', '_blank')" class="mt-2 text-xs lg:text-sm text-blue-300 hover:text-blue-200 transition-colors">Advanced Query (External)</button>
                </div>
                <div>
                    <h3 class="text-base lg:text-lg font-semibold text-white mb-3">Contact</h3>
                    <p class="text-xs lg:text-sm">Email: support@carrepairhelp.com</p>
                    <p class="text-xs lg:text-sm">Phone: +123 456 7890</p>
                </div>
            </div>
            <div class="mt-6 md:mt-8 border-t border-blue-700 pt-5 md:pt-6 text-center text-xs lg:text-sm">
                <p>&copy; <span id="currentYear"></span> Car Repair Assistance. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div id="overlay" class="fixed inset-0 bg-black bg-opacity-60 backdrop-blur-sm z-[100] hidden" onclick="closeAllPopups()"></div>

    <!-- Solution Popup -->
    <div id="solutionPopup" class="fixed top-1/2 left-1/2 w-11/12 max-w-lg p-5 sm:p-6 rounded-xl shadow-2xl z-[101] bg-white transition-all duration-300 ease-out popup-inactive">
        <div class="flex justify-between items-center mb-4">
            <h2 id="popupTitle" class="text-lg sm:text-xl md:text-2xl font-semibold text-[#1C4E80]">Solution Details</h2>
            <button onclick="closeSolutionPopup()" class="text-gray-500 hover:text-gray-800 text-2xl sm:text-3xl">&times;</button>
        </div>
        <p id="popupDescription" class="text-gray-700 mb-3 text-sm sm:text-base"></p>
        <p id="popupSolution" class="text-gray-700 font-medium text-sm sm:text-base mb-4"></p>
        <div id="popupImageContainer" class="flex flex-wrap justify-center gap-4 mb-4"></div>
        <button onclick="closeSolutionPopup()" class="mt-6 w-full bg-[#1C4E80] hover:bg-blue-800 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out">
            Close
        </button>
    </div>

    <!-- Help Button -->
    <button onclick="openHelpPopup()" title="Get Help" class="fixed bottom-24 right-5 md:right-8 bg-blue-600 hover:bg-blue-700 text-white p-3 rounded-full shadow-xl transition-all duration-150 ease-in-out transform hover:scale-110 z-50 flex items-center justify-center w-14 h-14">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-7 h-7">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
        </svg>
    </button>
    
    <!-- Help Popup -->
    <div id="helpPopup" class="fixed top-1/2 left-1/2 w-11/12 max-w-md p-5 sm:p-6 rounded-xl shadow-2xl z-[101] bg-white transition-all duration-300 ease-out popup-inactive">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-lg sm:text-xl font-semibold text-blue-700">Need More Help?</h2>
            <button onclick="closeHelpPopup()" class="text-gray-500 hover:text-gray-800 text-2xl sm:text-3xl">&times;</button>
        </div>
        <p class="text-gray-700 mb-2 text-sm sm:text-base">Contact our support team for additional assistance or use our AI Chatbot.</p>
        <p class="text-gray-700 text-sm sm:text-base"><span class="font-medium">Email:</span> support@carrepairhelp.com</p>
        <p class="text-gray-700 mb-4 text-sm sm:text-base"><span class="font-medium">Phone:</span> +123 456 7890</p>
        <button onclick="closeHelpPopup()" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-150 ease-in-out">
            Got it!
        </button>
    </div>

    <!-- Chatbot Toggle Button -->
    <button id="car-chatbot-toggle-button">
        <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/message-circle.svg" alt="Chatbot" class="car-chatbot-icon">
        Chatbot
    </button>

    <!-- Chatbot Window -->
    <div class="car-chatbot-container" id="car-chatbot-container">
        <header class="car-chatbot-header">
            <h1>CarChatBot</h1>
            <p>Your Virtual Car Assistant</p>
        </header>
        <div class="car-chatbot-messages" id="car-chatbot-messages"></div>
        <div class="car-chatbot-input-area">
            <input type="text" id="car-chatbot-user-input" placeholder="Ask about a car problem...">
            <div class="button-group">
                <button id="car-chatbot-send-button" disabled>
                    <img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/send.svg" alt="Send" class="car-chatbot-icon">
                    Send
                </button>
                <button id="car-chatbot-generate-tips-button" class="maintenance-tips-button">
                    âœ¨ Get Maintenance Tips
                </button>
            </div>
        </div>
        <div id="car-chatbot-loading-indicator"></div>
        <div class="car-chatbot-suggestion-box" id="car-chatbot-suggestion-box">
            <p>Common transmission problems:</p>
            <ul class="car-chatbot-suggestion-list" id="car-chatbot-suggestion-list"></ul>
        </div>
    </div>

<script>
    // Solution data remains the same
    const solutions = {
        'A':{title:"Damaged Seals",description:"Worn-out or damaged seals can cause fluid leaks.",solution:"Inspect and Replace Seals: Regularly inspect seals and replace them if damaged.",images:["https://placehold.co/400x250/AEC6CF/000000?text=Inspect+Seals","https://placehold.co/400x250/CDB8DF/000000?text=Replace+Seals"]},
        'B':{title:"Loose Connections",description:"Loose or improperly tightened connections can lead to leaks.",solution:"Tighten Connections: Ensure all connections are properly tightened.",images:["https://placehold.co/400x250/ADD8E6/000000?text=Check+Connections","https://placehold.co/400x250/BAF0BA/000000?text=Tighten+Bolt"]},
        'C':{title:"Corrosion",description:"Corrosion on transmission components can cause leaks.",solution:"Clean and Protect Components: Clean corroded parts and apply protective coatings.",images:["https://placehold.co/400x250/FFDDC1/000000?text=Remove+Corrosion","https://placehold.co/400x250/AEC6CF/000000?text=Apply+Protection"]},
        'D':{title:"Worn Clutches",description:"Clutches can wear out over time, causing slipping.",solution:"Replace Clutches: Replace worn clutches as needed.",images:["https://placehold.co/400x250/CDB8DF/000000?text=Worn+Clutch","https://placehold.co/400x250/ADD8E6/000000?text=New+Clutch+Plate"]},
        'E':{title:"Faulty Solenoids",description:"Defective solenoids can lead to improper gear engagement.",solution:"Repair or Replace Solenoids: Fix or replace faulty solenoids.",images:["https://placehold.co/400x250/BAF0BA/000000?text=Inspect+Solenoid","https://placehold.co/400x250/FFDDC1/000000?text=Solenoid+Replacement"]},
        'F':{title:"Low Fluid Levels (Slipping)",description:"Insufficient transmission fluid can cause slipping.",solution:"Refill Transmission Fluid: Maintain proper fluid levels and top up if necessary.",images:["https://placehold.co/400x250/AEC6CF/000000?text=Check+Fluid+Level","https://placehold.co/400x250/CDB8DF/000000?text=Add+Fluid"]},
        'G':{title:"Low Fluid Pressure",description:"Low fluid pressure can cause delays in gear engagement.",solution:"Check and Adjust Fluid Pressure: Ensure proper fluid pressure and adjust if needed.",images:["https://placehold.co/400x250/ADD8E6/000000?text=Fluid+Pressure+Check","https://placehold.co/400x250/BAF0BA/000000?text=Adjust+Pressure"]},
        'H':{title:"Dirty Transmission Filter",description:"A clogged filter can restrict fluid flow.",solution:"Replace Transmission Filter: Regularly replace the transmission filter.",images:["https://placehold.co/400x250/FFDDC1/000000?text=Dirty+Filter","https://placehold.co/400x250/AEC6CF/000000?text=New+Filter"]},
        'I':{title:"Faulty TCM",description:"A malfunctioning Transmission Control Module (TCM) can cause delays.",solution:"Diagnose and Repair TCM: Use diagnostic tools to identify and fix TCM issues.",images:["https://placehold.co/400x250/CDB8DF/000000?text=Diagnose+TCM","https://placehold.co/400x250/ADD8E6/000000?text=Repair+TCM"]},
        'J':{title:"Worn Transmission Bands",description:"Worn bands can cause harsh shifting.",solution:"Replace Transmission Bands: Replace worn bands as needed.",images:["https://placehold.co/400x250/BAF0BA/000000?text=Worn+Band","https://placehold.co/400x250/FFDDC1/000000?text=Replace+Band"]},
        'K':{title:"Improper Fluid Type",description:"Using the wrong type of transmission fluid can lead to harsh shifts.",solution:"Use Correct Fluid Type: Ensure the correct fluid type is used according to your vehicle's manual.",images:["https://placehold.co/400x250/AEC6CF/000000?text=Correct+Fluid","https://placehold.co/400x250/CDB8DF/000000?text=Fluid+Specs"]},
        'L':{title:"Dirty Transmission Components",description:"Dirt and debris can cause rough shifting.",solution:"Clean Transmission Components: Regularly clean and maintain transmission components.",images:["https://placehold.co/400x250/ADD8E6/000000?text=Clean+Components","https://placehold.co/400x250/BAF0BA/000000?text=Maintenance"]},
        'M':{title:"Low Fluid Levels (Overheating)",description:"Low fluid levels can cause overheating.",solution:"Maintain Fluid Levels: Regularly check and maintain fluid levels. Address any leaks.",images:["https://placehold.co/400x250/FFDDC1/000000?text=Fluid+Level","https://placehold.co/400x250/AEC6CF/000000?text=Check+for+Leaks"]},
        'N':{title:"Blocked Cooling Lines",description:"Blocked cooling lines can prevent proper cooling.",solution:"Clean Cooling Lines: Ensure cooling lines are clear and unobstructed. Flush if necessary.",images:["https://placehold.co/400x250/CDB8DF/000000?text=Clear+Lines","https://placehold.co/400x250/ADD8E6/000000?text=Flush+Cooling"]},
        'O':{title:"Faulty Cooling Fan",description:"A malfunctioning cooling fan can lead to overheating.",solution:"Repair or Replace Cooling Fan: Fix or replace a faulty cooling fan or its related components.",images:["https://placehold.co/400x250/BAF0BA/000000?text=Inspect+Cooling+Fan","https://placehold.co/400x250/FFDDC1/000000?text=Replace+Fan"]},
        'P':{title:"Worn Bearings",description:"Worn bearings can cause unusual noises (whining, grinding).",solution:"Replace Worn Bearings: This often requires transmission disassembly and professional help.",images:["https://placehold.co/400x250/AEC6CF/000000?text=Worn+Bearing","https://placehold.co/400x250/CDB8DF/000000?text=Bearing+Replacement"]},
        'Q':{title:"Loose Components",description:"Loose or damaged internal/external components can create noise.",solution:"Tighten or Replace Components: Inspect for loose bolts, mounts, or damaged parts.",images:["https://placehold.co/400x250/ADD8E6/000000?text=Check+Loose+Parts","https://placehold.co/400x250/BAF0BA/000000?text=Tighten+Components"]},
        'R':{title:"Lack of Lubrication",description:"Insufficient lubrication due to low fluid or old fluid can lead to noise.",solution:"Lubricate Components: Ensure proper fluid level and quality. Change fluid if old or contaminated.",images:["https://placehold.co/400x250/FFDDC1/000000?text=Check+Lubrication","https://placehold.co/400x250/AEC6CF/000000?text=Add+Lubricant"]}
    };

    // --- Page interaction script ---
    const overlay = document.getElementById('overlay');
    const solutionPopup = document.getElementById('solutionPopup');
    const helpPopup = document.getElementById('helpPopup');

    function openSolutionPopup(optionValue) {
        const data = solutions[optionValue];
        if (data) {
            document.getElementById('popupTitle').textContent = data.title;
            document.getElementById('popupDescription').textContent = data.description;
            document.getElementById('popupSolution').textContent = data.solution;
            
            const imageContainer = document.getElementById('popupImageContainer');
            imageContainer.innerHTML = ''; // Clear previous images
            data.images.forEach(imageUrl => {
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = `Solution for ${data.title}`;
                img.className = "w-full sm:w-5/12 h-auto rounded-lg shadow-md";
                imageContainer.appendChild(img);
            });

            overlay.classList.remove('hidden');
            solutionPopup.classList.remove('popup-inactive');
            solutionPopup.classList.add('popup-active');
        }
    }

    function closeSolutionPopup() {
        overlay.classList.add('hidden');
        solutionPopup.classList.add('popup-inactive');
        solutionPopup.classList.remove('popup-active');
    }

    function openHelpPopup() {
        overlay.classList.remove('hidden');
        helpPopup.classList.remove('popup-inactive');
        helpPopup.classList.add('popup-active');
    }

    function closeHelpPopup() {
        overlay.classList.add('hidden');
        helpPopup.classList.add('popup-inactive');
        helpPopup.classList.remove('popup-active');
    }

    function closeAllPopups() {
        closeSolutionPopup();
        closeHelpPopup();
        if (chatbotContainer.classList.contains('active')) {
             toggleChatbot(false);
        }
    }

    function optionClicked(value, selectElement) {
        openSolutionPopup(value);
        if(selectElement) {
            selectElement.selectedIndex = 0;
        }
    }

    function searchProblems() {
        const input = document.getElementById('searchInput').value.toLowerCase().trim();
        const cards = document.querySelectorAll('#cardsContainer .card');
        const noResultsMessage = document.getElementById('noResultsMessage');
        let resultsFound = false;

        cards.forEach(card => {
            const cardTexts = (card.textContent || card.innerText).toLowerCase();
            if (cardTexts.includes(input)) {
                card.style.display = 'flex';
                resultsFound = true;
            } else {
                card.style.display = 'none';
            }
        });

        noResultsMessage.classList.toggle('hidden', resultsFound);
    }
    
    document.getElementById('searchInput').addEventListener("keypress", function(event) {
        if (event.key === "Enter") {
            event.preventDefault();
            searchProblems();
        }
    });

    document.getElementById('currentYear').textContent = new Date().getFullYear();

    // --- New Chatbot Script (from engine.html) ---
    const chatMessages = document.getElementById('car-chatbot-messages');
    const userInput = document.getElementById('car-chatbot-user-input');
    const sendButton = document.getElementById('car-chatbot-send-button');
    const loadingIndicator = document.getElementById('car-chatbot-loading-indicator');
    const suggestionList = document.getElementById('car-chatbot-suggestion-list');
    const suggestionBox = document.getElementById('car-chatbot-suggestion-box');
    const chatbotContainer = document.getElementById('car-chatbot-container');
    const chatbotToggleButton = document.getElementById('car-chatbot-toggle-button');
    const generateTipsButton = document.getElementById('car-chatbot-generate-tips-button');

    // Transmission-specific problems
    const commonProblems = [
        "transmission fluid leak",
        "gear slipping",
        "delayed engagement",
        "harsh shifting",
        "transmission overheating",
        "whining noise",
    ];

    function populateSuggestions() {
        suggestionList.innerHTML = '';
        commonProblems.forEach(problem => {
            const listItem = document.createElement('li');
            listItem.textContent = problem;
            listItem.addEventListener('click', () => {
                userInput.value = problem;
                handleInputChange();
                sendMessage();
            });
            suggestionList.appendChild(listItem);
        });
    }

    async function getGeminiResponse(prompt) {
        loadingIndicator.style.display = 'block';
        sendButton.disabled = true;
        userInput.disabled = true;
        generateTipsButton.disabled = true;
        suggestionBox.style.display = 'none';

        try {
            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; // API key is handled by the environment
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();
            if (result.candidates?.[0]?.content?.parts?.[0]) {
                return result.candidates[0].content.parts[0].text;
            } else {
                console.error("Unexpected API response structure:", result);
                return "Sorry, I received an unusual response from the AI. Please try again.";
            }
        } catch (error) {
            console.error("Error calling Gemini API:", error);
            return "An error occurred while connecting to the AI. Please check the console for details.";
        } finally {
            loadingIndicator.style.display = 'none';
            userInput.disabled = false;
            generateTipsButton.disabled = false;
            suggestionBox.style.display = 'block';
            handleInputChange();
        }
    }

    async function sendMessage() {
        const userText = userInput.value.trim();
        if (!userText) return;

        addMessage('user', userText);
        userInput.value = '';
        handleInputChange();

        const botResponse = await getGeminiResponse(`Provide detailed car repair advice for the following transmission problem: ${userText}`);
        addMessage('bot', botResponse);
    }

    async function generateMaintenanceTips() {
        addMessage('user', "Generate some car maintenance tips.");
        const prompt = "Generate 5 practical and concise maintenance tips for a car's transmission system. Include advice on fluid, driving habits, and regular checks.";
        const botResponse = await getGeminiResponse(prompt);
        addMessage('bot', botResponse);
    }

    function addMessage(sender, text) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('car-chatbot-message', sender);
        const messageContentDiv = document.createElement('div');
        messageContentDiv.classList.add('car-chatbot-message-content');
        // A simple way to format the text to look a bit better
        messageContentDiv.innerHTML = text.replace(/\n/g, '<br>');
        messageDiv.appendChild(messageContentDiv);
        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function handleInputChange() {
        sendButton.disabled = !userInput.value.trim();
    }
    
    function toggleChatbot(forceClose = null) {
        const isActive = chatbotContainer.classList.contains('active');
        const shouldBeActive = forceClose === null ? !isActive : false;

        chatbotContainer.classList.toggle('active', shouldBeActive);
        if (shouldBeActive) {
            chatbotToggleButton.innerHTML = `<img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/x-circle.svg" alt="Close" class="car-chatbot-icon"> Close`;
        } else {
            chatbotToggleButton.innerHTML = `<img src="https://cdn.jsdelivr.net/npm/lucide-static@latest/icons/message-circle.svg" alt="Chatbot" class="car-chatbot-icon"> Chatbot`;
        }
    }


    // --- Event Listeners ---
    userInput.addEventListener('input', handleInputChange);
    sendButton.addEventListener('click', sendMessage);
    userInput.addEventListener('keydown', (event) => {
        if (event.key === 'Enter' && !sendButton.disabled) {
            sendMessage();
        }
    });
    generateTipsButton.addEventListener('click', generateMaintenanceTips);
    chatbotToggleButton.addEventListener('click', () => toggleChatbot());

    // Initialize chatbot on load
    addMessage('bot', "Hello! I'm your virtual car assistant. What transmission problem are you experiencing?");
    populateSuggestions();
</script>
</body>
</html>
